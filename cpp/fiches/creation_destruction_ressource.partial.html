_include(header,mytitle={Mémoire dynamique : Partage d'un objet (partie 2)})
<div class="w3-display-container w3-center">
  <img src="images/creation_objets/img_header.jpg" style="max-width:800px; width:100%; height:60%;" title="https://pixabay.com/fr/illustrations/bureau-mod%c3%a8le-art-3045123/" />
</div>
<div %div%>
  <h1 class="w3-wide">Mémoire dynamique : Création et destruction d'une ressource (partie 3)</h1>
</div>

<div %div%>
  _include(fiche_requise,elements={_include(fiche_requise_item,address=%cpp_cours%/partage_ressource.html,label={Mémoire dynamique : Partage d'une ressource (partie 2)})})
  <h2>Introduction</h2>
  <p %p%>
    Essayes de compiler les deux prochains morceaux de code (présents dans les <a href="https://github.com/chtimy/cours_exercices_ago/tree/master/Examples">exemples du repo</a>) et regardes la sortie à l'exécution, que se passe t-il?
  </p>
  <p %p%> 1er exemple : </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 481px; left: 11.9219px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;array&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">namespace</span> <span class="cm-def">StackOverflowExample</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">class</span> <span class="cm-def">Car</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">color</span>;</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  };</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">class</span> <span class="cm-def">Garage</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Car</span>, <span class="cm-number">1000000</span><span class="cm-operator">&gt;</span> <span class="cm-variable">m_cars</span>; <span class="cm-comment">// Création de 1 000 000 de voitures sur la pile</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  };</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Garage</span> <span class="cm-variable">garage</span>; <span class="cm-comment">// erreur ?</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre></div><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 496px;"></div><div class="CodeMirror-gutters" style="display: none; height: 496px;"></div></div></div></pre>
  </div>
  <p %p%> 2nd exemple</p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 1175.75px; left: 81.3438px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">namespace</span> <span class="cm-def">DangledPointerExample</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-keyword">class</span> <span class="cm-def">RoundTable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">float</span> <span class="cm-variable">m_radius</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span>(<span class="cm-variable-3">float</span> <span class="cm-variable">radius</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>: <span class="cm-variable">m_radius</span>(<span class="cm-variable">radius</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">float</span> <span class="cm-variable">getCurrentRadius</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-variable">m_radius</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">class</span> <span class="cm-def">IkeaMarket</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">RoundTable</span><span class="cm-operator">*&gt;</span> <span class="cm-variable">m_roundTables</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-variable">sell</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-comment">// On récupère la dernière table dans m_roundTables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">auto</span> <span class="cm-variable">table</span> <span class="cm-operator">=</span> <span class="cm-variable">m_roundTables</span>.<span class="cm-variable">back</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-comment">// On enlève la dernière table de m_roundTables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">m_roundTables</span>.<span class="cm-variable">pop_back</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-variable">table</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">void</span> <span class="cm-variable">store</span>(<span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-variable">roundTable</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">m_roundTables</span>.<span class="cm-variable">push_back</span>(<span class="cm-variable">roundTable</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">class</span> <span class="cm-def">IkeaFactory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-variable">createSmallTable</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span> <span class="cm-variable">roundTable</span>(<span class="cm-number">1.f</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">roundTable</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-variable">createBigTable</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span> <span class="cm-variable">roundTable</span>(<span class="cm-number">3.f</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">roundTable</span>;</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">void</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">IkeaFactory</span> <span class="cm-variable">ikeaFactory</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">IkeaMarket</span> <span class="cm-variable">ikeaMarket</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-comment">// Creation  de 5 petites tables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">5</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-variable">smallRoundTable</span> <span class="cm-operator">=</span> <span class="cm-variable">ikeaFactory</span>.<span class="cm-variable">createSmallTable</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">ikeaMarket</span>.<span class="cm-variable">store</span>(<span class="cm-variable">smallRoundTable</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-comment">// Achat d'une table</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">auto</span> <span class="cm-variable">soldTable</span> <span class="cm-operator">=</span> <span class="cm-variable">ikeaMarket</span>.<span class="cm-variable">sell</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Table radius : "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">soldTable</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getCurrentRadius</span>() <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1693px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1693px;"></div></div></div></pre>
  </div>
  <p %p%>
    Dans le premier exemple, un tableau de 1 000 000 de <code>Car</code> est créé sur une mémoire spécifique appelée la <b>pile</b> ou <i>stack</i> en anglais. On verra ce que représente cette mémoire dans cette fiche, mais ce qu'il faut savoir dès maintenant, c'est que c'est une mémoire très limitée. La taille dépend des architectures matérielles, mais globalement, 1 000 000 de <code>Car</code> va déclencher une erreur appelée <i>"StackOverflow"</i> (dépassement mémoire). On ne peut donc pas créer des gros objets (un gros tableau par exemple) sur cette mémoire au risque de la faire déborder. 
  </p>
  _include(guy_speaking,content={Et mais attend, c'est quoi ce <code>array</code>? Je croyais que pour créer des tableaux, il fallait utiliser des <code>vector?</code>})
  <p %p%>
    En effet, les deux existent, mais pour des raisons différentes, et justement parce qu'ils n'utilisent pas le même espace mémoire. <code>array</code> va utiliser de l'espace dans la pile, alors que le <code>vector</code> va utiliser de l'espace sur le tas (<i>heap</i> en anglais) qui est une mémoire que l'on peut considérer comme "illimitée". 
  </p>
  <p %p%>
    Dans le second exemple, on souhaite construire un magasin de tables <code>IkeaMarket</code> avec son usine <code>IkeaFactory</code>. Dans le code, l'usine <code>IkeaFactory</code> crée 5 petites tables pour venir ensuite renflouer les stock du magasin. Ensuite achète une table en appelant la méthode <code>sell</code> et on vérifie la mesure de la table vendue. Et bien... on se rend compte que la valeur affichée n'est pas du tout celle à laquelle on s'attend (ou alors le programme crash, çà dépend de la machine qui exécute ce code). Qu'est-ce qu'il s'est passé? Est-ce que le magasin de meuble vend des tables buggées? On va essayer d'y répondre :).  
  </p>
  <p %p%>
    Pour l'explication rapide, l'instanciation du nouvel objet <code>RoundTable</code> dans la méthode <code>createSmallTable</code> est réalisée sur la <b>pile</b> (<i>"stack"</i>). Lorsqu'on instancie un objet sur la pile, la durée de vie de l'objet est limité et se termine à la fin du bloc <code>{ }</code> dans lequel il a été créé. Dans notre cas, l'objet <code>roundTable</code> a atteint sa durée de vie à la fin de la méthode <code>CreateSmallTable</code>. Lorsqu'on retourne l'adresse de <code>roundTable</code>, c'est perdu d'avance puisqu'à la ligne suivante la table n'existe plus en mémoire.
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 63px; left: 257.383px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">RoundTable</span><span class="cm-operator">*</span> <span class="cm-def">createSmallTable</span>()</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">RoundTable</span> <span class="cm-variable">roundTable</span>(<span class="cm-number">1.f</span>); <span class="cm-comment">// Création d'un objet RoundTable sur la pile</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">roundTable</span>; <span class="cm-comment">// Retourne l'adresse de roundTable</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}<span class="cm-comment"> // Destruction de l'objet roundTable</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre>
  </div>
  _include(guy_speaking,content={Bon, mais c'est quoi tous ces trucs! La pile, le tas, pourquoi on a des mémoires différentes? Cà veut dire quoi la durée de vie d'un objet, sa destruction? Et c'est quoi le rapport avec les pointeurs?})
  <p %p%>
    Et bien allez! C'est le but de cette fiche de donner un petit aperçu global de tout ce bazar et de faire le lien avec l'utilité des pointeurs dans ce contexte.
  </p>
</div>
<div %div%>
  <h2 %h2%>La pile et la durée de vie d'un objet</h2>
  <p %p%>
    Une donnée de type générique (<code>float</code>, <code>int</code>) ou objet (<code>RoundTable</code>, <code>std::string</code>, ...) peut être créée en mémoire de deux façons.
  </p>
  <ul %ul%>
    <li><b>Création sur la pile (<i>stack</i>)</b></li>
    <li><b>Création sur le tas (<i>heap</i>)</b></li>
  </ul>
  <p %p%>
    Jusqu'à maintenant, on a seulement vu la création de données sur la pile à l'exception d'un objet : les <code>vector</code> qui sont des tableaux créés sur le tas. Commençons par comprendre ce qu'est la pile et son utilité avec ce schéma ci-dessous :
  </p>
  <img %img60% src="images/pointeurs/stack_layout.png" alt="https://en.wikipedia.org/wiki/Stack-based_memory_allocation" />
  <p %p%>
    La pile n'est ni plus ni moins qu'un segment mémoire de la RAM qui s'organise comme une pile. Alors oui c'est bizarre de dire çà, mais ce sont deux termes qui ont chacun leur définition.
  </p>
  <p %p%>
    On a vu dans les précédente fiche comment s'organisait la mémoire en général, on peut voir cette mémoire comme un tableau qui va de l'adresse 0 jusqu'à l'adresse correspondant à la taille limite de la mémoire RAM. Exemple, si la mémoire RAM fait 2go, alors la dernière adresse correspondrait à <a href="https://www.convertworld.com/fr/mesures-informatiques/gigaoctet-gigabyte.html">1073741823</a>. La pile est un morceau de cette mémoire avec une taille limitée que l'on ne peut pas dépasser. Nous n'avons pas l'obligation de déterminer la taille de la pile, on peut laisser le compilateur décider. Néanmoins dans certains cas, on pourrait tout à fait décider de définir soit-même la taille de la pile. Ce ne sera pas notre cas. 
  </p>
  <p %p%>
    La pile est structurée de telle façon à stocker des data dans des compartiments correspondants à des blocs <code>{}</code> comme par exemple une fonction, une boucle, une condition, ... On déroulera un exemple pour bien comprendre ce mécanisme. 
  </p>
  <p %p%>
    Tu as du remarquer lorsqu'on utilise un vecteur que l'on peut écrire et remplir un peu comme on veut les données à l'intérieur tant que la taille est suffisamment grande. Une pile est comme un vecteur mais avec un comportement beaucoup plus restreint. Ce comportement est similaire à un jeu très connu appelé la <a href="https://fr.wikipedia.org/wiki/Tours_de_Hano%C3%AF">tour de Hanoi</a>. L'image ci dessous est plus parlante, lorsqu'on ajoute une data A dans la pile, ensuite une data B, Pour accéder à la data A il faudra alors d'abord enlever la data B puisque c'est le dernier à être entrer dans la pile et donc le premier à en sortir.
  </p>
  <img %img30% src="images/pointeurs/pile.png" />
  <p %p%>
    Cà ne rappelle pas le fonctionnement des fonctions? Si j'appelle la fonction <code>a()</code> depuis la fonction <code>main</code>, puis la fonction <code>b()</code> depuis la fonction <code>b()</code>. Et bien depuis la fonction <code>b()</code> on ne peut pas revenir directement dans la fonction <code>main()</code>, il faut d'abord finir l'exécution de la fonction <code>b()</code>, ensuite de la fonction <code>a()</code> pour enfin revenir dans la fonction <code>main()</code> ... comme une pile quoi ^^ . Et comme par hasard, et bien c'est exactement le rôle de la pile (segment mémoire) de faire en sorte que l'exécution des fonctions soient réalisées comme çà. 
  </p>
  _include(guy_speaking,content={Mais alors qu'est-ce qu'on met dans la pile? Les noms des fonctions?})
  <p %p%>
    Non, on va venir simplement stocker ce qui nous est utile, c'est à dire les variables locales de chaque fonction. Petit exemple? Allez petit exemple.
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 561.5px; left: 233.617px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Bar</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">_value</span>;</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">value</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">_value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">foo2</span>(<span class="cm-variable">Bar</span> <span class="cm-variable">copyBar</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ <span class="cm-comment">// étape 7</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBar</span>(<span class="cm-number">2</span>); <span class="cm-comment">// étape 8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-comment">// étape 9</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-def">foo</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ <span class="cm-comment">// étape 4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBar</span>(<span class="cm-number">1</span>); <span class="cm-comment">// étape 5</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">foo2</span>(<span class="cm-variable">internalBar</span>); <span class="cm-comment">// étape 6</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">p_internalBar</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">internalBar</span>; <span class="cm-comment">// étape 10</span></span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">p_internalBar</span>; <span class="cm-comment">// étape 11</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-comment">// étape 12</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ <span class="cm-comment">// étape 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">bar</span>(<span class="cm-number">0</span>); <span class="cm-comment">// étape 2</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">barRef</span> <span class="cm-operator">=</span> <span class="cm-variable">foo</span>(); <span class="cm-comment">// étape 3</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text=" "> </span><span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">barRef</span><span class="cm-operator">-&gt;</span><span class="cm-variable">_value</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>; <span class="cm-comment">// étape 13</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-comment">// étape 14</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 786px;"></div><div class="CodeMirror-gutters" style="display: none; height: 786px;"></div></div></div></pre>
  </div>
  _include(notes,content={A chaque étape est associée le schéma de l'état courant de la pile.})
  <h3>Etape 1</h3>
  <p %p%>
    On commence par créer une zone mémoire pour la fonction <code>main</code> qui est la première fonction appelée lorsqu'on lance le programme. Cette zone mémoire est là pour stocker les potentielles variables locales créées dans la fonction <code>main</code>. Dans le schéma, on appelle cette zone mémoire une <i>frame</i> et donc la <i>frame active</i> désigne l'espace dans lequel l'exécution se situe, soit la fonction <code>main</code> dans notre cas. Le <i>stack pointer</i> correspond à l'endroit dans la <i>frame</i> active où le déroulement du programme se situe. Ce pointeur permet aussi de retrouver toutes les variables locales précédemment créées. Le <i>stack pointer</i> se situe pour le moment au début de la fonction <code>main</code>, puisque rien n'a été créé. Le <i>stack origin</i> désigne le début de la pile et <i>stack end</i> désigne la fin de la pile. Si on dépasse le <i>stack end</i>, alors une erreur de type <i>"stack overflow"</i> va surgir à l'exécution.
  </p>
  _include(notes,content={Chose importante dans le schéma, à chaque fois qu'une data est ajoutée à la pile, elle grandit vers le bas.})
  <img %img70% src="images/pointeurs/stack_example_01.png" />
  <h3>Etape 2</h3>
  <p %p%>
    On créé un objet de type <code>Bar</code> qui ne contient qu'une seule variable de type <code>int</code>. On va donc créer un emplacement mémoire à la position du <i>stack pointer</i> et venir y écrire l'objet <code>bar</code>. Ensuite le <i>stack pointer</i> avance vers le bas d'un bond de la taille de l'objet <code>bar</code>. La <i>frame</i> <code>main</code> est alors agrandie de la taille de <code>bar</code>.
  </p>
  <img %img70% src="images/pointeurs/stack_example_02.png" />
  <h3>Etape 3</h3>
  <p %p%>
    On appelle la fonction <code>foo</code>. Il y a création d'une nouvelle <i>frame</i>, puisqu'on change de bloc <code>{ }</code> et parce que toutes les nouvelles variables locales qui seront créées dans la fonction <code>foo</code> ne devront pas être mélangées avec les variables de la fonction <code>main</code>. Pour bien différencier la <i>frame</i> <code>foo</code> de la <i>frame</i> <code>main</code>, le système va écrire plusieurs informations dans le premier emplacement de la frame <code>foo</code> permettant de revenir proprement à la frame précédente (je ne développe pas ici comment çà marche, çà nous importe peu). Revenir à la frame précédente veut dire que l'on aura atteint soit une instruction <code>return</code>, soit la fin du bloc <code>{ }</code> de la fonction <code>foo</code>.
  </p>
  <h3>Etape 4</h3>
  <p %p%>
    Il n'y a pas de paramètre d'entrée dans la fonction <code>foo</code>, donc il ne se passe rien à cet étape.
  </p>
  _include(notes,content={La <i>frame</i> <code>foo</code> n'a connaissance d'aucune data à l'extérieur de lui même. Il ne peut donc pas accéder à la variable <code>bar</code> dans la <i>frame</i> <code>main</code>}.)
  <img %img70% src="images/pointeurs/stack_example_03.png" />
  <h3>Etape 5</h3>
  <p %p%>
    Comme pour l'étape 2, on créé un nouvel objet <code>Bar</code>, mais cette fois-ci dans la <i>frame</i> <code>foo</code>.
  </p>
  <img %img70% src="images/pointeurs/stack_example_04.png" />
  <h3>Etape 6</h3>
  <p %p%>
    On appelle la fonction <code>foo2</code>. Comme pour l'étape 3, il y a changement de <i>frame</i>, une autre zone mémoire est réservée à la suite dans la pile pour la <i>frame</i> <code>foo2</code>.
  </p>
  <img %img70% src="images/pointeurs/stack_example_05.png" />
  <h3>Etape 7</h3>
  <p %p%>
    La fonction <code>foo2</code> a un paramètre d'entrée de type <code>Bar</code>. Il y a création d'une variable locale (le paramètre) appelé <code>copyBar</code> à la suite du <i>stack pointer</i>. Les données de l'objet <code>internalBar</code> sont ensuite copiées dans ce nouvel emplacement mémoire (<code>copyBar</code>).
  </p>
  _include(notes,content={A noter que c'est l'un des moyens d'utiliser les données de <code>internalBar</code> dans la fonction <code>foo2</code>. Un autre moyen serait d'utiliser un pointeur sur l'objet <code>bar</code>.})
  <img %img70% src="images/pointeurs/stack_example_06.png" />
  <h3>Etape 8</h3>
  <p %p%>
    Comme pour les étapes 2 et 5, création d'un nouvel objet de type <code>Bar</code> dans la frame <code>foo2</code>.
  </p>
  _include(notes,content={Même si l'objet <code>internalBar</code> dans la fonction <code>foo2</code> a le même nom que l'objet <code>internalBar</code> dans la fonction <code>foo</code>, ces deux objets restent différents puisque stockés dans des <i>frames</i> différents.})
  <img %img70% src="images/pointeurs/stack_example_07.png" />
  <h3>Etape 9</h3>
  <p %p%>
    On atteint la fin de la fonction <code>foo2</code>. Ce qui signifie que toutes les data dans la <i>frame</i> <code>foo2</code> sont libérées et ne sont plus utilisables. <code>copyBar</code> et <code>internalBar</code> deviennent alors des objets invalides. En fonction des architectures ces zones mémoires sont soient laissées telles quelles ou réinitialisées avec des valeurs par défaut. Dans tous les cas, le programme pourra réécrire par dessus ces zones mémoire dès qu'il en aura besoin. Le <i>stack pointer</i> est déplacé en arrière juste après l'appel de la fonction <code>foo2</code>, soit après l'étape 6.
  </p>
  _include(notes,content={Le notion de pile prend tout son sens ici. Puiqu'à la fin de la fonction <code>foo2</code>, on va <b>dépiler</b> (sortir les data vers le bas dans notre cas) jusqu'à l'emplacement mémoire indiquant le lien de retour à la fonction <code>foo</code>})
  <img %img70% src="images/pointeurs/stack_example_08.png" />
  <h3>Etape 10</h3>
  <p %p%>
    Création d'une nouvelle variable contenant l'adresse de <code>internalBar</code> à l'emplacement du <i>stack pointer</i> comme pour l'étape 2, 5 et 8. La seule chose particulière ici, c'est que l'adresse <code>p_internalBar</code> accède par déréférencement à l'objet <code>internalBar</code>.
  </p>
  <img %img70% src="images/pointeurs/stack_example_09.png" />
  <h3>Etape 11 et 12</h3>
  <p %p%>
    On rencontre l'instruction <code>return</code>, ce qui signifie qu'on saute directement à l'étape 11. L'instruction <code>return</code> retourne la valeur dans la variable <code>p_internalBar</code> correspondant à l'adresse de <code>internalBar</code>. Le programme va dépiler la pile jusqu'à l'emplacement mémoire du lien vers la <i>frame</i> précédente. Le <i>stack pointer</i> est revenu à la fin de la <i>frame</i> <code>main</code> et la valeur copiée de <code>p_internalBar</code> est écrit dans un nouvel emplacement mémoire à la suite de la pile dans la <i>frame</i> <code>main</code>.
  </p>
  _include(notes,content={Voilà une grave erreur qui se passe ici mais dont on ne le saura que plus tard à l'exécution. On vient de renvoyer l'adresse d'une variable ne vivant que dans la <i>frame</i> <code>foo</code>, sauf que cette <i>frame</i> a été dépilée, la variable <code>internalBar</code> avec. On a donc une adresse qui pointe vers un emplacement de la pile qui a été libéré comme on peut le voir sur le schéma dessous. Le déréférencement de cette adresse, si çà a lieu, donnera un comportement non défini.})
  <img %img70% src="images/pointeurs/stack_example_10.png" />
  <img %img70% src="images/pointeurs/stack_example_11.png" />
  <h3>Etape 13</h3>
  <p %p%>
    Le programme essaye d'afficher la valeur à l'adresse contenue dans <code>barRef</code>. Sauf que cette valeur n'existe plus, ce qui provoque un comportement indéfini. Ce que l'on appelle comportement indéfini, c'est que rien de garantie que l'on retrouve la valeur demandée ou alors que çà ne cause un crash d'accès mémoire. Et en programmation, il ne vaut mieux pas miser sur la chance, c'est généralement très mauvais signe. 
  </p>
  <h3>Etape 14</h3>
  <p %p%>
    Si on admet qu'il n'y a pas de crash, alors le programme se termine on arrivant à la fin de la fonction <code>main</code>. La pile est libérée et l'exécution terminée.
  </p>
  <img %img40% src="images/pointeurs/stack_example_12.png" />
  <p %p%>
    Dans cette partie, on vient de voir le fonctionnement de la pile (<i>stack</i>), la notion de durée de vie des objets au sein de la pile et des risques liées lorsqu'on référence des objets qui vivent au sein de la pile. Pour régler le problème de l'étape 11, il faut non pas créer l'objet <code>internalBar</code> sur la pile, mais en dehors de la pile. Notre solution serait alors le <b>tas</b> (<i>heap</i>) et c'est justement l'objet de la prochaine partie.
  </p>
  _include(notes,content={Dans cette partie on a expliquée le fonctionnement de la pile et pourquoi çà marche bien avec le fonctionnement des fonctions. On a pas vraiment expliqué le POURQUOI le pile et un programme en c++ fonctionne de cette manière, mais si tu es intéressée je t'invite à te renseigner sur le net, il y a plein d'explications bien meilleures que ce que je pourrais proposer.})
</div>
<div %div%>
  <h2 %h2%>Contrôler la durée de vie d'un objet : pointeurs et tas</h2>
  <p %p%>
    Reprenons l'exemple précédent en simplifiant le code au problème que l'on veut résoudre.
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 509px; left: 11.9219px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Bar</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">_value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Bar</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">_value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-def">foo</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBar</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">internalBar</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">auto</span> <span class="cm-variable">barRef</span> <span class="cm-operator">=</span> <span class="cm-variable">foo</span>();</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 524px;"></div><div class="CodeMirror-gutters" style="display: none; height: 524px;"></div></div></div></pre>
  </div>
  <p %p%>
    Voici le plan. On veut pouvoir créer <code>internalBar</code> en mémoire dans la fonction <code>foo</code>; retourner son adresse et une fois que la fonction <code>foo</code> a fini son exécution; faire en sorte que l'objet <code>Bar</code> à cette même adresse soit toujours valide. On vient de voir que créer une variable locale sur la pile, çà ne fonctionnait pas. Et bien la solution serait, non pas de créer une donnée locale, mais une donnée en dehors en dehors de la pile, dans un autre segment mémoire qui ne serait pas impacté par le dépilement des <i>frames</i> dans la pile. Cette mémoire on la nomme le tas ou <i>heap</i>. Pour visualiser un peu ce qu'est le tas, voilà un schéma mettant côté à côté la pile et le tas.
  </p>
  <img %img60% src="images/pointeurs/stack_heap.png" />
  <p %p%>
    Le tas est un segment mémoire qui se situe ailleurs dans la RAM pour permettre justement de stocker des données en dehors de toutes les <i>frames</i> de la pile. Cette mémoire n'a pas de comportement spécifique comme la pile, c'est juste un gros tableau (avec une taille quasi infinie => la limite est la taille de la RAM) où on y entasse juste les données et on peut accéder à n'importe laquelle comme on le souhaite tant qu'on a un <b>lien</b> vers ces données depuis la pile.<br/>
  </p>
  <p %p%>
    Et bien, c'est parti, essayons de créer notre objet <code>Bar</code> sur le tas sans crainte qu'elle soit détruite. Le mot magique pour demander d'allouer et d'écrire dans le tas, c'est le mot clé <b><code>new</code></b>. Soit<br/>
    <span><center><code>TYPE* NAME = new TYPE([PARAMETERS])</code><center/></span>
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 141.75px; left: 323.789px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-def">foo</span>()</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Création sur la pile et stockage dans la variable internalBarOnStack</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBarOnStack</span>(<span class="cm-number">1</span>);</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Création sur le tas et stockage de l'adresse dans internalBarOnHeap</span></span></pre></div><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">internalBarOnHeap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Bar</span>(<span class="cm-number">1</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-variable">internalBarOnHeap</span>;</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 210px;"></div><div class="CodeMirror-gutters" style="display: none; height: 210px;"></div></div></div></pre>
  </div>
  _include(guy_speaking,content={Mais pourquoi on utilise un pointeur pour l'instanciation sur le tas?})
  <p %p%>
    En effet, pourquoi pas utiliser une variable plutôt qu'un pointeur comme on le fait sur la pile. D'abord on se fait une piqure de rappel sur la notion de pointeur dans le contexte de la pile.
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 509px; left: 11.9219px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Bar</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">_value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Bar</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">_value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">foo</span>(<span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">p_bar</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-comment">// manipulation de bar par déréférencement de p_bar</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">bar</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">foo</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">bar</span>);</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 524px;"></div><div class="CodeMirror-gutters" style="display: none; height: 524px;"></div></div></div></pre>
  </div>
  <p %p%>
    La pile au moment d'arriver dans la fonction <code>foo</code> devrait ressembler à çà:
  </p>
  <img %img70% src="images/pointeurs/stack_pointeur.png" />
  <p %p%>
    La différence entre un pointeur et une variable qui n'est pas un pointeur, c'est que le pointeur contient l'adresse d'une variable, alors que la variable qui n'est pas un pointeur désigne directement une valeur créée dans la <i>frame</i> active. On ne manipule pas la même chose dans les deux cas. Le pointeur nous permet de pouvoir manipuler des données n'importe où dans la mémoire. Cà peut être une data qui se situe dans la même <i>frame</i> que le pointeur, ou alors dans une <i>frame différente</i> (c'est l'exemple de <code>p_bar</code> pointant sur l'objet stocké dans <code>bar</code>) ou encore complètement ailleurs dans le tas. 
  </p>
  <p %p%>
    Maintenant que cela est dit, l'utilisation d'un pointeur pour une valeur stockée dans le tas prend son sens, puisque c'est le seul moyen de pouvoir atteindre une valeur qui n'est pas dans la <i>frame</i> active. Si on reprend l'exemple ci-dessus:
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 561.75px; left: 458.359px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Bar</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">_value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">_value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-def">foo</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBarOnStack</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">internalBarOnHeap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Bar</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-variable">internalBarOnHeap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">auto</span> <span class="cm-variable">p_bar</span> <span class="cm-operator">=</span> <span class="cm-variable">foo</span>();</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">p_bar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">_value</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>; <span class="cm-comment">// Affiche 1</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 603px;"></div><div class="CodeMirror-gutters" style="display: none; height: 603px;"></div></div></div></pre>
  </div>
  <p %p%>
    Voici la représentation de la pile et du tas.
  </p>
  <img %img% src="images/pointeurs/stack_heap_2.png" />
  <p %p%>
    On a bien notre pointeur <code>internalBarOnHeap</code> qui pointe sur une data en dehors de la pile. Sans lui, on aurait aucun moyen d'accéder à cet objet <code>Bar</code>. 
  </p>
  _include(notes,content={On remarque au passage que le pointeur <code>p_bar</code> est <code>null</code> pour le moment car il n'a pas encore reçu l'adresse retournée par la fonction <code>foo</code>})
  <p %p%>
    Lorsque l'adresse contenue dans ce pointeur est retournée dans la fonction <code>main</code> puis stockée dans le pointeur <code>p_bar</code>, l'adresse reste toujours valide comme l'objet en dehors de la pile n'est pas impacté par la fin de l'exécution de la fonction <code>foo</code> comme le montre le schéma ci-dessous.
  </p>
  <img %img% src="images/pointeurs/stack_heap_3.png" />
</div>
<div %div%>
  <h2 %h2%>Destruction d'une ressource allouée sur le tas</h2>
  <p %p%>
    L'utilisation du tas est finalement très simple : "Réserve moi de la mémoire sur le tas pour un objet de type Bar et remplis l'emplacement en appelant son constructeur" => <code>Bar* p_bar = new Bar(1.0);</code>. Bon la gestion de la mémoire sur le tas est tellement simple, qu'il existe un revers de la médaille pour tout compliquer. A chaque fois qu'une data est créée sur le tas, c'est à nous, développeur, de détruire cette même data quand on en a plus besoin. La question qui suit est triple, c'est <b>pourquoi, quand et comment</b>.
  </p>
  <p %p%>
    <b>Pourquoi?</b> Libérer une data du tas, c'est faire de la place pour une autre data. Si je ne fais pas çà, je peux vite me retrouver à remplir la RAM, voir même la dépasser parce que je n'ai pas nettoyé correctement le tas, c'est ce que l'on appelle une <b>fuite de mémoire</b>. Imagines qu'on programme une librairie qui charge des données d'une image en mémoire GPU. Je charge une première image de 500 mo en mémoire CPU avant de passer les données en mémoire GPU, parce que je ne peux pas faire autrement. Le chargement sur CPU de l'image se fait en stockant toutes les pixels de l'image sur le tas. Une fois que j'ai chargé l'image sur GPU, je ne nettoie pas le tas. Et bien je viens de perdre 500 mo de ma RAM. Si j'en charge une dizaine d'autres de la même façon, je perd 5go de ma RAM, et ainsi de suite, et on voit bien que ce n'est pas acceptable.
  </p>
  <p %p%>
    <b>Quand savoir libérer une ressource</b> est toujours un casse-tête surtout dans les gros programmes qui font des milliers de lignes de code et qui déclarent des ressources sur le tas un peu partout. En général, on souhaite libérer une ressource le plus vite possible après que l'on en ait plus besoin. Parfois c'est faisable, parfois c'est plus compliqué, mais restons simple pour le moment. Dans l'exemple précédent, on a alloué un objet <code>Bar</code> dans la fonction <code>foo</code>. On a besoin de cet objet jusque dans la fonction <code>main</code> au moment de l'affichage de son attribut <code>_value</code>, ensuite il ne nous est plus d'utilité. Si on ne fait rien, alors la mémoire allouée pour cet objet n'est pas libéré et prend donc la place de quelqu'un d'autre qui en aurait potentiellement besoin. Pour éviter une fuite de mémoire, il faut alors demander à la mémoire de libérer l'objet. 
  </p>
  <p %p%>
    <b>La libération d'une ressource sur le tas se fait un peu de la même manière que l'allocation</b>, mais cette fois-ci c'est le mot-clé <code>delete</code> qui est utilisé. On l'utilise de cette façon :<br/>
    <code>delete POINTEUR_SUR_LA_RESSOURCE;</code><br/>
    Ni plus, ni moins. Dans le code, çà donnerait alors:
  </p>
  <div id='write'  class=''>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 614.5px; left: 11.9219px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Bar</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">_value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">_value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-def">foo</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span> <span class="cm-variable">internalBarOnStack</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="  ">    </span><span class="cm-variable">Bar</span><span class="cm-operator">*</span> <span class="cm-variable">internalBarOnHeap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Bar</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">return</span> <span class="cm-variable">internalBarOnHeap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp=""></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">auto</span> <span class="cm-variable">p_bar</span> <span class="cm-operator">=</span> <span class="cm-variable">foo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">p_bar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">_value</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text=" ">    </span><span class="cm-keyword">delete</span> <span class="cm-variable">p_bar</span>;</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 630px;"></div><div class="CodeMirror-gutters" style="display: none; height: 630px;"></div></div></div></pre>
  </div>
  <p %p%>
    Je n'ai pas grand chose à rajouter d'autre sur la libération des données sur le tas. Il faut juste savoir que si un <code>new</code> est fait quelque part dans le code, il y a forcément un delete à faire ailleurs, sinon c'est une fuite mémoire. On verra dans une autre fiche que ce mécanisme d'allocation/désallocation sur le tas avec <code>new</code>/<code>delete</code> pose beaucoup de problèmes et qu'aujourd'hui on préfère utiliser des pointeurs dits "intelligents" qui font le travail à notre place.
  </p>
  _include(exercice,content={Maintenant que tu sais tout sur l'allocation sur le tas, est-ce que tu saurais résoudre les deux problématiques au début de cette fiche ?})
</div>

_include(conclusion,content={
  <div %div%>
    <h2 class="w3-opacity">Résumé</h2>
    <ul %ul%>
      <li>Il existe deux segments de mémoire importants utilisés en c++, la pile (<i>stack</i>) et le tas (<i>heap</i>).</li>
      <li>La pile permet de compartimenter les données créées dans chaque fonction afin de limiter leur durée de vie.</li>
      <li>Une donnée allouée sur la pile dans une fonction A, est détruite à la fin de l'exécution de cette même fonction A.</li>
      <li>Une donnée allouée sur le tas est réalisé à l'aide du mot clé <code>new</code>. L'appel d'un constructeur d'un objet reste le même principe : <code>new TYPE([PARAMETERS])</code></li>
      <li>Une donnée allouée sur le tas doit être désallouée, sinon il y a une fuite mémoire. La désallocation est réalisée avec le mot clé <code>delete</code> suivi du nom du pointeur pointant sur la ressource à libérer.</li>
    </ul>
    _include(exercice,content={Question : <code>Bar* p_bar = new Bar(1.0);</code> => Est-ce que le pointeur <code>p_bar</code> est alloué sur la pile ou sur le tas?})
  </div>
  })
</div>
</body>
</html>